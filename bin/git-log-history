#! /usr/bin/env bash

git log $@ --color=always --format="format:%Cgreen%h%Creset %C(cyan)<%as>%Creset%C(Yellow)|%-d|%Creset%s" |
    tr -s '|' |
    perl -0 -pe 's/\n/\0/gm' |
    sed 's/|/\n/g;/^[[:space:]]*$/d;s/^ //g;s/\n /\n/g' |
    fzf \
        --read0 \
        --ansi \
        --layout=reverse \
        --multi \
        --no-sort \
        --wrap \
        --preview 'git show --color=always {1}' \
        --border rounded \
        --preview-window=right,75%,wrap,border-line \
        --footer-border=line \
        --margin 0 \
        --padding 1 \
        --border-label " git log $* (?: toggle view) " \
        --gap 1 \
        --gap-line $'\u00b7' \
        --bind "focus:transform-footer(git diff-tree --no-commit-id --name-only {1} -r | head -n 30)" \
        --bind "focus:+transform-footer-label(git diff-tree --no-commit-id --name-only {1} -r | wc -l | xargs printf ' %d files ')" \
        --bind "home:first,end:last" \
        --bind "?:change-preview-window(bottom,75%,wrap|right,75%,wrap)" \
        --color "border:#526760" \
        --color "label:#ffffff:bold" \
        --color "bg:#090C0C" \
        --color "footer:#ffffff:italic" \
        --highlight-line \
        --marker-multi-line '┏┃┗' \
        --accept-nth=1 \

